---
format: html
editor: visual
---

```{r, eval = F}
# This code chunk contains code to install all of the dependencies
# necessary to compile and run your report, using if-statements to
# reduce install time for unnecessary code.
# It should be set to eval = F by default, so you aren't installing
# software on someone's computer without their consent.

# This works for packages that are on CRAN
if (!"dplyr" %in% installed.packages()) {
  install.packages("dplyr")
}
if (!"remotes" %in% installed.packages()) {
  install.packages("remotes")
}

# This is how to do it for a package that's only on github
if (!"emo" %in% installed.packages()) {
  remotes::install_github("hadley/emo")
}  

```

```{r}
#| echo: false

BabyNames <- read.csv("Popular_Baby_Names.csv")
#colnames(BabyNames)
#str(BabyNames)


sum(is.na(BabyNames)) # check missing values; no missing values

library(dplyr)
# distinct this dataset; remove the repeated rows based on X element 


BabyNames$Child.s.First.Name <- tolower(BabyNames$Child.s.First.Name)

# Using unique function to get 
babynames<- unique(BabyNames) # remove the repeated rows; 

# combine the ethnic groups b/c they have the same meaning
modified_data <- babynames %>% mutate(Ethnicity = recode(Ethnicity, "BLACK NON HISP" = "BLACK NON HISPANIC" ,
                                                      "ASIAN AND PACI" = "ASIAN AND PACIFIC ISLANDER",
                                                      "WHITE NON HISP" = "WHITE NON HISPANIC" )) 

# check the result; there are total 4 levels in the ethnic groups
#M_data1 <- modified_data %>% group_by(Ethnicity) %>% count()
#M_data2 <- modified_data %>% group_by(Ethnicity, Gender) %>% count()
```

## Introduction

### Description of the Data set

This dataset `BabyNames` consist of the popular baby names by sex and ethnic group from 2011 to 2019, and it was collected through civil birth registration. There is other information about how the data.citynewyork.us collected the data. But we think they may collect the data from online registration system. Each row represents *a popular baby* first name . There are 6 columns, `Year of Birth`, it is quantitative and indicates the year of the baby birth; `Year of Birth` includes year from 2011 to 2019; `Gender`, it is categorical variable (Male and Female); `Ethnicity` is a categorical variable and it indicates the mother's ethnicity; `Child.s.First.Name` is a categorical variable, it represents baby's first name; `Count` is quantitative and the value represents the frequency of names were collected through civil birth registration; and `Rank` represents the frequency of baby names in descending order in each year.

### Cleaning the Data

In the data cleaning phase, we imported the dataset and discovered that it does not contain any missing values. Additionally, we identified and removed duplicate rows from the initial dataset. There are some ethic groups have the similar names such as `ASIAN AND PACIFIC ISLANDER` and `ASIAN AND PACI`, `BLACK NON HISPANIC` and `BLACK NON HISP` and `WHITE NON HISPANIC` and `WHITE NON HISP`. They are the same ethic groups but with different names, so we combine them before we perform analysis regarding our interest, and finally we will use the `modified_data` to do further data analysis. `Black non-Hispanic(BNH)` refers to a person having origins in any of the black racial groups of Africa (except those of Hispanic origin); `White non-Hispanic(WNH)` means a person having origins in any of the original peoples of Europe, the Middle East, or North Africa but not in Hispanic. `Hispanic(H)` refers to a person of Cuban, Mexican, Puerto Rican, South or Central American, or other Spanish culture or origin, regardless of race, and `Aisan and Pacific Islander(API)` means a person having origins in any of the original peoples of the Far East, Southeast Asia, or the Indian Subcontinent, including, for example, Cambodia, China, India, Japan, Korea, Malaysia, Pakistan, the Philippine Islands, Thailand, and Vietnam, also includes a person having origins in any of the original peoples of Hawaii, Guam, Samoa, or other Pacific Islands. Finally, there are total 2 quantitative variables, `Year of Birth` and `Count`; 4 categorical variables, `Gender`, `Ethnicity`, `Child.s.First.Name` and `Rank`.

(Source:[Ethnic Information1](https://portal.ct.gov/-/media/DOT/documents/ddbe/RaceandEthnicIdentificationDefinitions2015pdf.pdf) [Ethnic Information2](https://research.schev.edu/info/Glossary/Black-or-African-American-Black-non-Hispanic#:~:text=Term%3A%20Black%20or%20African%20American,except%20those%20of%20Hispanic%20origin) [Ethnic Information23](https://www.census.gov/topics/population/race/about.html))

### Aims

First, we display the top ten most popular first names for each gender and ethnic group using bar charts. These graphs are easily readable. The top 10 popular baby first names are displayed on the horizontal axis, and the frequency of each name is shown on the vertical axis. In relation to the bar graphs depicting various ethnic groups, we have eight charts, each representing the top 10 baby first names for both males and females across four distinct ethnic groups. While these charts make it easy to identify the most popular names within each group, comparing common names across all groups simultaneously poses a challenge. To address this, we have also created a bar graph to show the results using a combined dataset. Additionally, we aim to identify unisex names---those used for both genders.

Our next aim is to show the average length of names over time. Are shorter names more popular now? To address this question, we display a time plot showing the average length of first names recorded in our dataset from 2011 to 2019. From the plot, we can see the trend over time.

##### ----This is for Samitha....----

## Methods

We use `str()` function to display the structure of the data, identify the categorical variables and quantitative variables. Use `sum()` to see any missing values in the data. We also see some repeated rows, so we used `distinct()` function to get unique rows in the raw data. To identify common names used across different ethnic groups, we used the `inner_join()` function to merge the two datasets and determine any overlapping results. What we used a lot for this project

## Topic of Exploration

The first question we address is what the top 10 most popular first names are for each gender and ethnic group, and the results are displayed in Figure 1 and Figure 2.

```{r filter dataset by M and F}
#| echo: false

# select top 10 female's names
vf_data <- modified_data %>% 
  filter(Gender == "FEMALE") %>% 
  group_by(Child.s.First.Name, Gender) %>% 
  summarise(freq = sum (Count),  .groups = "drop") %>% 
  arrange(desc(freq)) %>% head(10)

# select top 10 male's names
vm_data <- modified_data %>% 
  filter(Gender == "MALE") %>% 
  group_by(Child.s.First.Name, Gender) %>%
  summarise(freq = sum(Count), .groups = "drop") %>% 
  arrange(desc(freq)) %>% 
  head(10)
```

```{r}
#| label: fig-genders1
#| fig-width: 8
#| fig-height: 4 # Change the figure dimensions using fig-width/height
#| out-width: 80% # This changes the size of the figure as rendered in the text. 
#| fig-cap: "Bar Graph of the Top 10 First Names for Males and Females"
#| echo: false

library(ggplot2)

vm_data$Child.s.First.Name <-factor(vm_data$Child.s.First.Name, levels = vm_data$Child.s.First.Name) 

ggplot(data=vm_data, aes(x= Child.s.First.Name, y=freq)) +
  geom_bar(stat="identity", fill = 'steelblue2') +
  theme(axis.text.x = element_text(angle =45, hjust = 1)) +
  labs(title = "Top 10 Popular Male Babies' Names", 
       subtitle = "from 2011 to 2019", 
       x = "Child's First Name", 
       y = "Count") + 
    theme_minimal()

vf_data$Child.s.First.Name <-factor(vf_data$Child.s.First.Name, levels = vf_data$Child.s.First.Name) 

ggplot(data=vf_data, aes(x= Child.s.First.Name, y=freq)) +
  geom_bar(stat="identity", fill = 'hotpink') +
  theme(axis.text.x = element_text(angle =45, hjust = 1)) +
  labs(title = "Top 10 Popular Female Babies' Names", 
       subtitle = "from 2011 to 2019", 
       x = "Child's First Name", 
       y = "Count") + 
    theme_minimal()
```

We can see the top 10 names for each gender on horizontal axis from these two bar charts, and the frequency of each name displayed on vertical axis.

In each bar chart, we clearly display the top 10 males and females names for each ethnic group, as shown in Figures 1.2.1 to 1.2.8. These charts make it easy to read the names specific to each ethnic group within each gender. However, the question arises: how do we visualize some names shared among different ethnic groups? Are there any names that are used by both White non-Hispanic (WNH) males and Black non-Hispanic (BNH) males? Or by both White non-Hispanic (WNH) females and Black non-Hispanic (BNH) females? To address these questions, we merged datasets from two ethnic groups. We then plotted the results to highlight any such commonalities from Figures 3 to Figure 10.

```{r filter dataset by ethnic groups}
#| echo: false

# top 10 names in ethnic group of API between Males and Females
em1_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "ASIAN AND PACIFIC ISLANDER" & Gender == "MALE") %>% group_by(Child.s.First.Name) %>% summarise(freqM_API = sum(Count), .groups = "drop") %>% arrange(desc(freqM_API)) %>% head(n=10)

ef1_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "ASIAN AND PACIFIC ISLANDER", Gender == "FEMALE") %>% group_by(Child.s.First.Name) %>% summarise(freqF_API = sum(Count)) %>% arrange(desc(freqF_API)) %>% slice_head(n=10)


# top 10 names in ethnic group of BNH between Males and Females
em2_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "BLACK NON HISPANIC", Gender == "MALE") %>% group_by(Child.s.First.Name) %>% summarise(freqM_BNH = sum(Count)) %>% arrange(desc(freqM_BNH)) %>% slice_head(n=10)

ef2_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "BLACK NON HISPANIC", Gender == "FEMALE") %>% group_by(Child.s.First.Name) %>% summarise(freqF_BNH = sum(Count)) %>% arrange(desc(freqF_BNH)) %>% slice_head(n=10)

# top 10 names in ethnic group of H between Males and Females
em3_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "HISPANIC", Gender == "MALE") %>% group_by(Child.s.First.Name) %>% summarise(freqM_H = sum(Count)) %>% arrange(desc(freqM_H)) %>% slice_head(n=10)

ef3_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "HISPANIC", Gender == "FEMALE") %>% group_by(Child.s.First.Name) %>% summarise(freqF_H = sum(Count)) %>% arrange(desc(freqF_H)) %>% slice_head(n=10)

# top 10 names in ethnic group of WNH between Males and Females
em4_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "WHITE NON HISPANIC", Gender == "MALE") %>% group_by(Child.s.First.Name) %>% summarise(freqM_WNH = sum(Count)) %>% arrange(desc(freqM_WNH)) %>% slice_head(n=10)

ef4_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "WHITE NON HISPANIC", Gender == "FEMALE") %>% group_by(Child.s.First.Name) %>% summarise(freqF_WNH = sum(Count)) %>% arrange(desc(freqF_WNH)) %>% slice_head(n=10)

```

```{r}
#| label: fig-genders2
#| fig-width: 8
#| fig-height: 4 # Change the figure dimensions using fig-width/height
#| out-width: 80% # This changes the size of the figure as rendered in the text. 
#| fig-cap: "Bar Graph of the Top 10 Males Names for Asian and Pacific Islander "
#| echo: false


# display in ordered by count
em1_data$Child.s.First.Name <-factor(em1_data$Child.s.First.Name, levels = em1_data$Child.s.First.Name) 

ggplot(data = em1_data, aes(x = Child.s.First.Name, y = freqM_API)) + 
  geom_bar(stat = "identity", fill = 'lightblue') +  
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
  labs(title = "Top 10 Asian and Pacific Islander First Names For Boys",
       x = "Name",
       y = "Count") + 
      theme_minimal()
```

```{r}
#| label: fig-genders3
#| fig-width: 8
#| fig-height: 4 # Change the figure dimensions using fig-width/height
#| out-width: 80% # This changes the size of the figure as rendered in the text. 
#| fig-cap: "Bar Graph of the Top 10 Females Names for Asian and Pacific Islander"
#| echo: false


# display in ordered by count
ef1_data$Child.s.First.Name <-factor(ef1_data$Child.s.First.Name, levels = ef1_data$Child.s.First.Name) 

ggplot(data = ef1_data, aes(x = Child.s.First.Name, y = freqF_API)) + 
  geom_bar(stat = "identity", fill = 'lightpink') +  
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
  labs(title = "Top 10  Asian and Pacific Islander First Names For Girls",
       x = "Name",
       y = "Count") + 
      theme_minimal()
```

```{r}
#| label: fig-genders4
#| fig-width: 8
#| fig-height: 4 # Change the figure dimensions using fig-width/height
#| out-width: 80% # This changes the size of the figure as rendered in the text. 
#| fig-cap: "Bar Graph of the Top 10 Males Names for Black Non-Hispanic "
#| echo: false


# display in ordered by count
em2_data$Child.s.First.Name <-factor(em2_data$Child.s.First.Name, levels = em2_data$Child.s.First.Name) 

ggplot(data = em2_data, aes(x = Child.s.First.Name, y = freqM_BNH)) + 
  geom_bar(stat = "identity", fill = 'lightblue') +  
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
  labs(title = "Top 10 Black non Hispanic First Names For Boys",
       x = "Name",
       y = "Count") + 
      theme_minimal()
```

```{r}
#| label: fig-genders5
#| fig-width: 8
#| fig-height: 4 # Change the figure dimensions using fig-width/height
#| out-width: 80% # This changes the size of the figure as rendered in the text. 
#| fig-cap: "Bar Graph of the Top 10 Females Names for Black Non-Hispanic"
#| echo: false

# display in ordered by count
ef2_data$Child.s.First.Name <-factor(ef2_data$Child.s.First.Name, levels = ef2_data$Child.s.First.Name) 

ggplot(data = ef2_data, aes(x = Child.s.First.Name, y = freqF_BNH)) + 
  geom_bar(stat = "identity", fill = 'lightpink') +  
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
  labs(title = "Top 10 Black non Hispanic First Names For Girls",
       x = "Name",
       y = "Count") + 
      theme_minimal()
```

```{r}
#| label: fig-genders6
#| fig-width: 8
#| fig-height: 4 # Change the figure dimensions using fig-width/height
#| out-width: 80% # This changes the size of the figure as rendered in the text. 
#| fig-cap: "Bar Graph of the Top 10 Males Names for Hispanic"
#| echo: false


# display in ordered by count
em3_data$Child.s.First.Name <-factor(em3_data$Child.s.First.Name, levels = em3_data$Child.s.First.Name) 

ggplot(data = em3_data, aes(x = Child.s.First.Name, y = freqM_H)) + 
  geom_bar(stat = "identity", fill = 'lightblue') +  
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
  labs(title = "Top 10 Hispanic First Names For Boys",
       x = "Name",
       y = "Count") + 
      theme_minimal()
```

```{r}
#| label: fig-genders7
#| fig-width: 8
#| fig-height: 4 # Change the figure dimensions using fig-width/height
#| out-width: 80% # This changes the size of the figure as rendered in the text. 
#| fig-cap: "Bar Graph of the Top 10 Females Names for Hispanic"
#| echo: false


# display in ordered by count
ef3_data$Child.s.First.Name <-factor(ef3_data$Child.s.First.Name, levels = ef3_data$Child.s.First.Name) 

ggplot(data = ef3_data, aes(x = Child.s.First.Name, y = freqF_H)) + 
  geom_bar(stat = "identity", fill = 'lightpink') +  
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
  labs(title = "Top 10 Hispanic First Names For Girls",
       x = "Name",
       y = "Count") + 
      theme_minimal()
```

```{r}
#| label: fig-genders8
#| fig-width: 8
#| fig-height: 4 # Change the figure dimensions using fig-width/height
#| out-width: 80% # This changes the size of the figure as rendered in the text. 
#| fig-cap: "Bar Graph of the Top 10 Males Names for White Non-Hispanic"
#| echo: false

# display in ordered by count
em4_data$Child.s.First.Name <-factor(em4_data$Child.s.First.Name, levels = em4_data$Child.s.First.Name) 

ggplot(data = em4_data, aes(x = Child.s.First.Name, y = freqM_WNH)) + 
  geom_bar(stat = "identity", fill = 'lightblue') +  
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
  labs(title = "Top 10 White Non Hispanic First Names For Boys",
       x = "Name",
       y = "Count") + 
      theme_minimal()
```

```{r}
#| label: fig-genders9
#| fig-width: 8
#| fig-height: 4 # Change the figure dimensions using fig-width/height
#| out-width: 80% # This changes the size of the figure as rendered in the text. 
#| fig-cap: "Bar Graph of the Top 10 Females Names for White Non-Hispanic"
#| echo: false


# display in ordered by count
ef4_data$Child.s.First.Name <-factor(ef4_data$Child.s.First.Name, levels = ef4_data$Child.s.First.Name) 

ggplot(data = ef4_data, aes(x = Child.s.First.Name, y = freqF_WNH)) + 
  geom_bar(stat = "identity", fill = 'lightpink') +  
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
  labs(title = "Top 10 White Non Hispanic First Names For Girls",
       x = "Name",
       y = "Count") + 
      theme_minimal()
```

```{r merge data sets for all males and females WNH and BNH 10 to 20}
#| echo: false
#| 


library(dplyr)
# develop merge of males between 2 ethnic groups
inner_M1 <- inner_join(em1_data, em3_data, by = "Child.s.First.Name")
inner_M2 <- inner_join(em2_data, em4_data, by = "Child.s.First.Name") 
#inner_M2 # no common result; why? different culture

# expand dataset with top 20 names
em22_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "BLACK NON HISPANIC", Gender == "MALE") %>% group_by(Child.s.First.Name) %>% summarise(freqM_BNH = sum(Count)) %>% arrange(desc(freqM_BNH)) %>% slice_head(n=20)

em44_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "WHITE NON HISPANIC", Gender == "MALE") %>% group_by(Child.s.First.Name) %>% summarise(freqM_WNH = sum(Count)) %>% arrange(desc(freqM_WNH)) %>% slice_head(n=20)


inner_M22 <- inner_join(em22_data, em44_data, by = "Child.s.First.Name")
#inner_M22 # luckily, we get common results but the culture plays an important role in names

####---------------------------------------------------------------------------------------------####

# develop merge of female between 2 ethnic groups
inner_F1 <- inner_join(ef1_data, ef3_data, by = "Child.s.First.Name")
inner_F2 <- inner_join(ef2_data, ef4_data, by = "Child.s.First.Name")
#inner_F2 # only one common names

ef22_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "BLACK NON HISPANIC", Gender == "FEMALE") %>% group_by(Child.s.First.Name) %>% summarise(freqF_BNH = sum(Count)) %>% arrange(desc(freqF_BNH)) %>% slice_head(n=20)

ef44_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "WHITE NON HISPANIC", Gender == "FEMALE") %>% group_by(Child.s.First.Name) %>% summarise(freqF_WNH = sum(Count)) %>% arrange(desc(freqF_WNH)) %>% slice_head(n=20)

inner_F22 <- inner_join(ef22_data, ef44_data, by = "Child.s.First.Name")
#inner_F22 # Again, cultures difference 

####-----------------------------------------------------------------------####
```

```{r merge data sets for all males and females WNH and BNH 50}
#| echo: false
#| 

# expand dataset with top 50 names
em50_BNH_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "BLACK NON HISPANIC", Gender == "MALE") %>% group_by(Child.s.First.Name) %>% summarise(freqM_BNH = sum(Count)) %>% arrange(desc(freqM_BNH)) %>% slice_head(n=50)

em50_WNP_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "WHITE NON HISPANIC", Gender == "MALE") %>% group_by(Child.s.First.Name) %>% summarise(freqM_WNH = sum(Count)) %>% arrange(desc(freqM_WNH)) %>% slice_head(n=50)


inner_M50 <- inner_join(em50_BNH_data, em50_WNP_data, by = "Child.s.First.Name")
#inner_M50 # more common names but not too much

####---------------------------------------------------------------------------------------------####


ef50_BNH_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "BLACK NON HISPANIC", Gender == "FEMALE") %>% group_by(Child.s.First.Name) %>% summarise(freqF_BNH = sum(Count)) %>% arrange(desc(freqF_BNH)) %>% slice_head(n=50)

ef50_WNH_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "WHITE NON HISPANIC", Gender == "FEMALE") %>% group_by(Child.s.First.Name) %>% summarise(freqF_WNH = sum(Count)) %>% arrange(desc(freqF_WNH)) %>% slice_head(n=50)

inner_F50 <- inner_join(ef50_BNH_data, ef50_WNH_data, by = "Child.s.First.Name")
#inner_F50 # Again, cultures difference 

####-----------------------------------------------------------------------####
```

After merging the datasets of White non-Hispanic (WNH) and Black non-Hispanic (BNH) for the top 10 names among males and females, we found no common names among the males and only one common name, `Olivia`, among females. When we expanded the list to the top 20 names, we discovered three common names for boys and four for girls used across both ethnic groups. Although extending the range of names revealed more commonalities, the frequency of each name varied significantly between the groups. To illustrate this, we plotted a side-by-side bar chart showing the frequency of names between WNH and BNH. Our aim is to convey that different ethnic groups tend to use different names, largely influenced by cultural differences. The results are displayed from Figure 11 to Figure 13.

```{r}
#| label: fig-ethnic2
#| fig-width: 8
#| fig-height: 4 
#| out-width: 80%  
#| fig-cap: "Side-by-Side Bar Graph of Common Names Among the Top 20 for WNH and BNH Males"
#| echo: false

library(reshape2)
melt_M22 <- melt(inner_M22, id.vars = 'Child.s.First.Name')
melt_M22$variable <- as.character(melt_M22$variable )
melt_M22$variable <- gsub('freqM_BNH', 'Black non-Hispanic - Male', melt_M22$variable)
melt_M22$variable <- gsub('freqM_WNH', 'White non-Hispanic - Male', melt_M22$variable)

ggplot(data = melt_M22, aes(x = Child.s.First.Name, y = value, fill = variable)) + 
  geom_bar(stat = "identity", position = position_dodge()) +  
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +  
  labs(title = "Common Males Frist Name Between Black non-Hispanic and White non-Hispanic",
        subtitle = "within top 20", 
       x = "Name",
       y = "Frequency",
       fill = "Ethnic Group")+
  theme_minimal()

```

```{r}
#| label: fig-ethnic4
#| fig-width: 8
#| fig-height: 4 
#| out-width: 80%  
#| fig-cap: "Side-by-Side Bar Graph of Common Names Among the Top 10 for WNH and BNH Females" 
#| echo: false


melt_F2 <- melt(inner_F2, id.vars = 'Child.s.First.Name')
melt_F2$variable <- as.character(melt_F2$variable )
melt_F2$variable <- gsub('freqF_BNH', 'Black non-Hispanic - Female', melt_F2$variable)
melt_F2$variable <- gsub('freqF_WNH', 'White non-Hispanic - Female', melt_F2$variable)

ggplot(data = melt_F2, aes(x = Child.s.First.Name, y = value, fill = variable)) + 
  geom_bar(stat = "identity", position = position_dodge()) +  
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +  
  labs(title = "Common Females Frist Name Between Black non-Hispanic and White non-Hispanic",
        subtitle = "within top 10", 
       x = "Name",
       y = "Frequency",
       fill = "Ethnic Group")+
  theme_minimal()

```

```{r}
#| label: fig-ethnic5
#| fig-width: 8
#| fig-height: 4 
#| out-width: 80%  
#| fig-cap: "Side-by-Side Bar Graph of Common Names Among the Top 20 for WNH and BNH Females"
#| echo: false


melt_F22 <- melt(inner_F22, id.vars = 'Child.s.First.Name')
melt_F22$variable <- as.character(melt_F22$variable )
melt_F22$variable <- gsub('freqF_BNH', 'Black non-Hispanic - Female', melt_F22$variable)
melt_F22$variable <- gsub('freqF_WNH', 'White non-Hispanic - Female', melt_F22$variable)

ggplot(data = melt_F22, aes(x = Child.s.First.Name, y = value, fill = variable)) + 
  geom_bar(stat = "identity", position = position_dodge()) +  
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +  
  labs(title = "Common Females Frist Name Between Black non-Hispanic and White non-Hispanic",
        subtitle = "within top 20", 
       x = "Name",
       y = "Frequency",
       fill = "Ethnic Group")+
  theme_minimal()

```

```{r}
#| label: fig-ethnic1
#| fig-width: 8
#| fig-height: 4 
#| out-width: 80%  
#| fig-cap: "Side-by-Side Bar Graph of Common Names Among the Top 10 for API and H Males"
#| echo: false

library(reshape2)
melt_M1 <- melt(inner_M1, id.vars = 'Child.s.First.Name')
melt_M1$variable <- as.character(melt_M1$variable )
melt_M1$variable <- gsub('freqM_API', 'Asian Pacific Islander - Male', melt_M1$variable)
melt_M1$variable <- gsub('freqM_H', 'Hispanic - Male', melt_M1$variable)

ggplot(data = melt_M1, aes(x = Child.s.First.Name, y = value, fill = variable)) + 
  geom_bar(stat = "identity", position = position_dodge()) +  
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +  
  labs(title = "Common Males Frist Name Between Asian Pacific Islander and Hispanic",
        subtitle = "within top 10", 
       x = "Name",
       y = "Frequency",
       fill = "Ethnic Group")+
  theme_minimal()

```

```{r}
#| label: fig-ethnic3
#| fig-width: 8
#| fig-height: 4 
#| out-width: 80%  
#| fig-cap: "Side-by-Side Bar Graph of Common Names Among the Top 10 for API and H Females"
#| echo: false


inner_F1 <- melt(inner_F1, id.vars = 'Child.s.First.Name')
inner_F1$variable <- as.character(inner_F1$variable )
inner_F1$variable <- gsub('freqF_API', 'Asian Pacific Islander - Female', inner_F1$variable)
inner_F1$variable <- gsub('freqF_H', 'Hispanic - Female', inner_F1$variable)

ggplot(data = inner_F1, aes(x = Child.s.First.Name, y = value, fill = variable)) + 
  geom_bar(stat = "identity", position = position_dodge()) +  
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +  
  labs(title = "Common Female Frist Name Between Asian Pacific Islander and Hispanic",
        subtitle = "within top 10", 
       x = "Name",
       y = "Frequency",
       fill = "Ethnic Group") +
  theme_minimal()
```

We are also interested in unisex names, which are used for both genders. The results are shown in Figure 16.

```{r Develop Unisex Name: merge males and females within the same ethnic groups}
#| echo: false

## Develop Unisex Name: merge males and females within the same ethnic groups 
em1_100_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "ASIAN AND PACIFIC ISLANDER" & Gender == "MALE") %>% group_by(Child.s.First.Name) %>% summarise(freqM_API = sum(Count), .groups = "drop") %>% arrange(desc(freqM_API)) %>% head(n=1000)

ef1_100_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "ASIAN AND PACIFIC ISLANDER", Gender == "FEMALE") %>% group_by(Child.s.First.Name) %>% summarise(freqF_API = sum(Count)) %>% arrange(desc(freqF_API)) %>% slice_head(n=1000)

inner_com1 <- inner_join(em1_100_data, ef1_100_data, by = "Child.s.First.Name")
# found 4 unisex names


em2_100_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "BLACK NON HISPANIC", Gender == "MALE") %>% group_by(Child.s.First.Name) %>% summarise(freqM_BNH = sum(Count)) %>% arrange(desc(freqM_BNH)) %>% slice_head(n=1000)

ef2_100_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "BLACK NON HISPANIC", Gender == "FEMALE") %>% group_by(Child.s.First.Name) %>% summarise(freqF_BNH = sum(Count)) %>% arrange(desc(freqF_BNH)) %>% slice_head(n=1000)

inner_com2 <- inner_join(em2_100_data, ef2_100_data, by = "Child.s.First.Name")
# no result

### selected 1000 to see whether there is unisex name; check M_data2 to each # of each gender or ethnic group
em3_100_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "HISPANIC", Gender == "MALE") %>% group_by(Child.s.First.Name) %>% summarise(freqM_H = sum(Count)) %>% arrange(desc(freqM_H)) %>% slice_head(n=1000)

ef3_100_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "HISPANIC", Gender == "FEMALE") %>% group_by(Child.s.First.Name) %>% summarise(freqF_H = sum(Count)) %>% arrange(desc(freqF_H)) %>% slice_head(n=1000)

inner_com3 <- inner_join(em3_100_data, ef3_100_data, by = "Child.s.First.Name")


em4_100_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "WHITE NON HISPANIC", Gender == "MALE") %>% group_by(Child.s.First.Name) %>% summarise(freqM_WNH = sum(Count)) %>% arrange(desc(freqM_WNH)) %>% slice_head(n=1000)

ef4_100_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "WHITE NON HISPANIC", Gender == "FEMALE") %>% group_by(Child.s.First.Name) %>% summarise(freqF_WNH = sum(Count)) %>% arrange(desc(freqF_WNH)) %>% slice_head(n=1000)

inner_com4 <- inner_join(em4_100_data, ef4_100_data, by = "Child.s.First.Name")

# Females Names
VF_data <- modified_data %>% 
  filter(Gender == "FEMALE") %>% 
  group_by(Child.s.First.Name, Gender) %>% 
  summarise(freq = sum (Count),  .groups = "drop") %>% 
  arrange(desc(freq))

# Males Names
VM_data <- modified_data %>% 
  filter(Gender == "MALE") %>% 
  group_by(Child.s.First.Name, Gender) %>%
  summarise(freq = sum(Count), .groups = "drop") %>% 
  arrange(desc(freq))

inner_COM <- inner_join(VF_data, VM_data, by = "Child.s.First.Name") %>% head(10)

###----------------------------------------------------------------------###

library(tidyr)
df_long <- pivot_longer(inner_COM, 
                        cols = c(freq.x, freq.y), 
                        names_to = "Gender", 
                        values_to = "Frequency",
                        names_prefix = "freq.")
df_long$Gender <- recode(df_long$Gender, 'x' = 'FEMALE', 'y' = 'MALE')
```

```{r}
#| label: fig-combined
#| fig-width: 8
#| fig-height: 4 
#| out-width: 80%  
#| fig-cap: "Side-by-Side Bar Graph of Unisex Names"
#| echo: false


ggplot(data = df_long, aes(x = Child.s.First.Name, y = Frequency, fill = Gender)) + 
  geom_bar(stat = "identity", position = position_dodge()) +  
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +  
  labs(title = "Unisex Names Frenquency by Gender",
       x = "Name",
       y = "Frequency",
       fill = "Gender")+
  theme_minimal()
```

What surprised us is that 'Dylan' is popular for both males and females. This popularity can be attributed to its meaning, 'son of the sea,' which retains a poetic, windswept quality, particularly when used for girls (Source: [Dylan](https://nameberry.com/babyname/dylan/girl)). Additionally, 'Avery' traditionally a boy's name meaning 'ruler of the elves' in English, is now more common for girls (Source: [Avery](https://nameberry.com/babyname/avery/girl)). We also observed that 'Tenzin' is exclusively used in Asian and Pacific Islander (API) groups, for both males and females. The name Tenzin, meaning 'Holder of the teaching,' is chosen in API communities, reflecting a significant religious influence (Source: [Tenzin](https://nameberry.com/babyname/tenzin/girl)). Overall, the choice of unisex names is primarily influenced by their meanings, but religious and cultural factors also play a crucial role.

Figure 17 and Figure 18 displays the average length of names for each gender, and each ethnic group.

```{r calculate average length of letters for names}
#| echo: false

library(stringr)
# calculate the length of letter of each name
length_data <- modified_data %>% mutate(N.Length = str_count(Child.s.First.Name, "[A-Za-z]")) %>% mutate(T.length = Count * N.Length) 
# calculate the average number of letters in each year for males and females
avglength_data <- length_data  %>% group_by(Year.of.Birth, Gender) %>% 
  summarise(Avg.Letters = mean(N.Length, na.rm = TRUE), .groups = "drop") %>% 
  arrange(Year.of.Birth, Gender)
# calculate the average number of letters in each year for each ethnic groups
avglength_data_ethnic <- length_data  %>% group_by(Year.of.Birth, Ethnicity) %>% 
  summarise(Avg.Letters = mean(N.Length, na.rm = TRUE), .groups = "drop") %>% 
  arrange(Year.of.Birth, Ethnicity)

```

```{r}
#| label: fig-AverageLength1
#| fig-width: 8
#| fig-height: 4 
#| out-width: 80%  
#| fig-cap: "Average Length of First Names for Males and Females"
#| echo: false


ggplot(data = avglength_data, aes(x = Year.of.Birth, y = Avg.Letters, color = Gender, group = Gender)) + 
  geom_line() +
  geom_point() +
  scale_x_continuous(breaks = seq(2011, 2019, by=1), limits = c(2011, 2019)) +
  labs(title = "Average Number of Letters in Babies' Name by Gender", 
       subtitle = "from 2011 to 2019", 
       x = "Year", 
       y = "Average Number of Letters") + 
    theme_minimal()
```

```{r}
#| label: fig-AverageLength2
#| fig-width: 8
#| fig-height: 4 
#| out-width: 80%  
#| fig-cap: "Average Length of First Names for Different Ethnic Groups"
#| echo: false


ggplot(data = avglength_data_ethnic, aes(x = Year.of.Birth, y = Avg.Letters, color = Ethnicity, group = Ethnicity)) + 
  geom_line() +
  geom_point() +
  scale_x_continuous(breaks = seq(2011, 2019, by=1), limits = c(2011, 2019)) +
  labs(title = "Average Number of Letters in Babies' Name by Ethnicity", 
       subtitle = "from 2011 to 2019", 
       x = "Year", 
       y = "Average Number of Letters") + 
    theme_minimal()
```

The time plot shows the average length of letters in baby first names from 2011 to 2019, we observe that, overall, the average length of names has decreased over time. The primary reason for this trend is a growing preference for shorter names. Many people today favor short names as they are easier to remember and can also be more unique. In exploring other factors contributing to the popularity of short names, Katie highlighted that shorter names are often associated with higher salaries in "Study: Short Names Are Long on Earning Power". (Source:[Popularity](https://daily.jstor.org/science-baby-names/) [Shorter Name Higher Salary](https://associationsnow.com/2013/05/study-short-names-are-long-on-earning-power/) [Study Says Shorter Names Earn More](https://www.forbes.com/sites/laurashin/2013/05/07/study-says-shorter-names-earn-more/?sh=443c788972ea))

## Additional Exploration topic

From the time plot of average length of names, we observe that the mean length for males are shorter than the females, does it due to males are seeking for unique names? Also, from the time plot of different ethnic groups, the average name of Asian and Pacific Islander are the smallest among ethnic groups. One reason could be different culture. We might need to read other articles to understand the background of API and difference between males and females names. 
####---- Samitha add his part---###


Overall, besides these plots above, we are also wondering if there is way for us to search a specific name so that we can find all information such as ranking and year corresponding to this name. We create an interactive plot to show `Babynames`. In this interactive plot, we can search a name or filter the ethnic group to look for what we are interest in.  




## Conclusion
Different ethnic groups have different preferred babies names due to different culture especially for White Non-Hispanic and Black Non-Hispanic. Unisex names could be a trend today and parents would like to prefer the meaning of names and break the original rules of naming babies. In addition, the average length of names decreases over time and people prefer the short names because . Another reason is people are affected by the research "shorter name, more money". Parents hope children to be successful. `Samitha needs to modified his part.`

