---
format: html
editor: visual
---

```{r, eval = F}
# This code chunk contains code to install all of the dependencies
# necessary to compile and run your report, using if-statements to
# reduce install time for unnecessary code.
# It should be set to eval = F by default, so you aren't installing
# software on someone's computer without their consent.

# This works for packages that are on CRAN
if (!"dplyr" %in% installed.packages()) {
  install.packages("dplyr")
}
if (!"remotes" %in% installed.packages()) {
  install.packages("remotes")
}

# This is how to do it for a package that's only on github
if (!"emo" %in% installed.packages()) {
  remotes::install_github("hadley/emo")
}  

```



```{r}
BabyNames <- read.csv("Popular_Baby_Names.csv")
colnames(BabyNames)
str(BabyNames)
#unique_Ethic <- unique(BabyNames$Ethnicity); unique_Ethic

sum(is.na(BabyNames)) # check missing values; no missing values

library(dplyr)
# distinct this dataset; remove the repeated rows based on X element 
D_BabyNames <- BabyNames %>% distinct() 

updated_data <- D_BabyNames %>% group_by(Ethnicity) %>% summarise()
# count frequency of each ethnic group
updated_data1 <- D_BabyNames %>% group_by(Ethnicity) %>% count()


BabyNames$Child.s.First.Name <- tolower(BabyNames$Child.s.First.Name)
# Using unique function to get the same dataset as D_BabyNames
babynames<- unique(BabyNames) # remove the repeated rows; 
#babynames$Child.s.First.Name <- tolower(babynames$Child.s.First.Name)

# combine the ethnic groups b/c they have the same meaning
modified_data <- babynames %>% mutate(Ethnicity = recode(Ethnicity, "BLACK NON HISP" = "BLACK NON HISPANIC" ,
                                                      "ASIAN AND PACI" = "ASIAN AND PACIFIC ISLANDER",
                                                      "WHITE NON HISP" = "WHITE NON HISPANIC" )) 

# check the result; there are total 4 levels in the ethnic groups
M_data1 <- modified_data %>% group_by(Ethnicity) %>% count()
M_data2 <- modified_data %>% group_by(Ethnicity, Gender) %>% count()
```

## Introduction

This dataset `BabyNames` consist of the popular baby names by sex and ethnic group from 2011 to 2019, and it was collected through civil birth registration. There is other information about how the data.citynewyork.us collected the data. But we think they may collect the data from online registration system. Each row represents one baby's first name. There are 6 columns, `Year of Birth`, it is quantitative and indicates the year of the baby birth; `Year of Birth` includes year from 2011 to 2019; `Gender`, it is categorical variable (Male and Female); `Ethnicity` is a categorical variable and it indicates the mother's ethnicity; `Child.s.First.Name` is a categorical variable, it represents baby's first name; `Count` is quantitative and the value represents the frequency of names were collected through civil birth registration; and `Rank` is the ranking of each baby's name in each year. There are some ethic groups have the similar names such as `ASIAN AND PACIFIC ISLANDER` and `ASIAN AND PACI`, `BLACK NON HISPANIC` and `BLACK NON HISP` and `WHITE NON HISP` and `WHITE NON HISPANIC`. They are the same ethic groups but with different names, so we combine them before we perform analysis regarding our interest, and finally we will use the `modified_data` to do further data analysis. *put ethnic group definition here; also reference...from online*

In the step of data cleaning, we import the data and found there is no missing values in this data set. We also combined the ethic groups with the same meaning of names, finally, there are total 2 quantitative variables, `Year of Birth` and `Count`; 4 categorical variables, `Gender`, `Ethnicity`, `Child.s.First.Name` and `Rank`.

Firstly, start with a simple question. Display the top ten popular first names in each gender and ethnic groups and we are going to use a bar chart to display it. People can easily read these two graphs, the top 10 popular baby's first names were displayed on the horizontal axis, the occurrence of each baby's first names was displayed on the vertical line. From the bar graphs regarding different ethnic groups, there are 4 bars charts for 4 different ethnic groups. It is easy to read the top 10 baby's first name from each bar group but it may not easy to read a more common results at once. We also plot a bar graph displaying top 10 baby's first name based on a joint data set. 

We want to investigate whether the names that have consistently remained popular over several years or decades. In this question, we need to use inner_join function to see if we can get the common names over time. This analysis need much time than previous questions. (note: 2011 to 2019, 9 years, summarize 9 dataframes with popular names between genders/ethnic groups) Display names in genders/ethnic groups each year in interactive graph, then display to merged data.

##From the graphs, state any common results. Any results like different ethnic groups have totally different popular names? Answer this after displaying plot.... updated...

Besides, we will display a time plot to show the average length of first names recorded in the dataset from 2011 to 2019. Analyze any trends here such as the increasing or decreasing trend. Why it changes as time moves on. Short names are popular and this is a trend today. (note: analyze the average of length of first names between genders from 2011 to 2019) To calculate the length of each names, apply what we learned in the class and use dyply package to calculate the average length. Then display the time plot which the horizontal axis is time, the vertical axis is the average length of first names.


### Introduce your dataset and basic questions for exploration. Explain any unique approaches you will take or any interesting features of your dataset that you have to overcome. Cite the source of your dataset, and briefly discuss how it was collected.

### Discuss the variables in the dataset and if there are anomalies in the variables, provide some visual assessment of the anomalies and explain how they may have arisen. You should cover most of the information in your proposal data section, but should primarily use paragraphs and not lists/tables (the exception may be a list of e.g. items which were measured).

Draft of Samitha - How does the ranking (rank) of a name change over time? - A possible questions we might be able to answer is, are there any noticeable spikes in the popularity of names related to popular culture, such as movie characters or celebrities?

Feedback from professor: "It might be interesting to look at different spellings of similar names (e.g. Keily, Kylee, Kylie)" no need to identify all, some are good too.

## Methods

Use `str()` function to display the structure of the data, identify the categorical variables and quantitative variables. Use `sum()` to see any missing values in the data. There is no missing values and we also see some repeated rows, so we use `distinct()` to get unique rows in the raw data.

### Describe any data cleaning and rearranging you needed to do to get your dataset into a workable form. Make sure to cite any packages which were important in your data cleaning process in this section. For instance, if you used dplyr, then it would be appropriate to say something like

> we used the group-apply-combine paradigm with the `dplyr` functions `group_by` and `summarize` [@dplyr-package] to generate a dataset for each day of the observation period from the 15-minute interval observations in the raw data set.

## Topic of Exploration

Here, you want to introduce the first topic you want to explore with your (newly cleaned up) data. Code to process data should be contained in chunks above this point, and those chunks should *not* be included in the report.

You can add options to executable code like this

The first question is what are the top 10 popular first names in each gender and ethnic groups? The appropriate graph is bar chart.

```{r}
#| echo: false

library(dplyr)
# select top 10 female's names
vf_data <- modified_data %>% 
  filter(Gender == "FEMALE") %>% 
  group_by(Child.s.First.Name, Gender) %>% 
  summarise(freq = sum (Count),  .groups = "drop") %>% 
  arrange(desc(freq)) %>% head(10)

# select top 10 male's names
vm_data <- modified_data %>% 
  filter(Gender == "MALE") %>% 
  group_by(Child.s.First.Name, Gender) %>%
  summarise(freq = sum(Count), .groups = "drop") %>% 
  arrange(desc(freq)) %>% 
  head(10)
```




```{r}
#| echo: false


# top 10 names in ethnic group of API
em1_data <- modified_data %>% filter(Ethnicity == "ASIAN AND PACIFIC ISLANDER" & Gender == "MALE") %>% group_by(Child.s.First.Name) %>% summarise(freqM_API = sum(Count)) %>% arrange(desc(freqM_API)) %>% slice_head(n=10)


# top 10 names in ethnic group of BNH
e2_data <- modified_data %>% filter(Ethnicity == "BLACK NON HISPANIC") %>% group_by(Child.s.First.Name, Ethnicity) %>% summarise(freq_API = sum(Count), .groups = "drop") %>% arrange(desc(freq_API)) %>% head(n=10)


# top 10 names in ethnic group of H
e3_data <- modified_data %>% filter(Ethnicity == "HISPANIC") %>% group_by(Child.s.First.Name, Ethnicity) %>% summarise(freq_API = sum(Count), .groups = "drop") %>% arrange(desc(freq_API)) %>% head(n=10)


# top 10 names in ethnic group of WNH
e4_data <- modified_data %>% filter(Ethnicity == "WHITE NON HISPANIC") %>% group_by(Child.s.First.Name, Ethnicity) %>% summarise(freq_API = sum(Count), .groups = "drop") %>% arrange(desc(freq_API)) %>% head(n=10)
```

# bar graph of top 10 popular baby's first name between girls and boys

```{r}
#| label: fig-genders
#| fig-width: 8
#| fig-height: 4 # Change the figure dimensions using fig-width/height
#| out-width: 80% # This changes the size of the figure as rendered in the text. 
#| fig-cap: "This figure shows the top 10 first names between males and females."
#| echo: false

library(ggplot2)

vf_data$Child.s.First.Name <-factor(vf_data$Child.s.First.Name, levels = vf_data$Child.s.First.Name) 

ggplot(data=vf_data, aes(x= Child.s.First.Name, y=freq)) +
  geom_bar(stat="identity", fill = 'hotpink') +
  theme(axis.text.x = element_text(angle =45, hjust = 1)) +
  labs(title = "Top 10 Popular Female Babies' Names", 
       subtitle = "from 2011 to 2019", 
       x = "Child's First Name", 
       y = "Count") + 
    theme_minimal()

vm_data$Child.s.First.Name <-factor(vm_data$Child.s.First.Name, levels = vm_data$Child.s.First.Name) 

ggplot(data=vm_data, aes(x= Child.s.First.Name, y=freq)) +
  geom_bar(stat="identity", fill = 'steelblue2') +
  theme(axis.text.x = element_text(angle =45, hjust = 1)) +
  labs(title = "Top 10 Popular Male Babies' Names", 
       subtitle = "from 2011 to 2019", 
       x = "Child's First Name", 
       y = "Count") + 
    theme_minimal()
```


# bar graph of top 10 names in different ethnic groups between boys and girls

```{r}
#| echo: false

# top 10 names in ethnic group of API between Males and Females
em1_data <- modified_data %>% filter(Ethnicity == "ASIAN AND PACIFIC ISLANDER" & Gender == "MALE") %>% group_by(Child.s.First.Name) %>% summarise(freqM_API = sum(Count), .groups = "drop") %>% arrange(desc(freqM_API)) %>% head(n=10)

ef1_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "ASIAN AND PACIFIC ISLANDER", Gender == "FEMALE") %>% group_by(Child.s.First.Name) %>% summarise(freqF_API = sum(Count)) %>% arrange(desc(freqF_API)) %>% slice_head(n=10)


# top 10 names in ethnic group of BNH between Males and Females
em2_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "BLACK NON HISPANIC", Gender == "MALE") %>% group_by(Child.s.First.Name) %>% summarise(freqM_BNH = sum(Count)) %>% arrange(desc(freqM_BNH)) %>% slice_head(n=10)

ef2_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "BLACK NON HISPANIC", Gender == "FEMALE") %>% group_by(Child.s.First.Name) %>% summarise(freqF_BNH = sum(Count)) %>% arrange(desc(freqF_BNH)) %>% slice_head(n=10)

# top 10 names in ethnic group of H between Males and Females
em3_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "HISPANIC", Gender == "MALE") %>% group_by(Child.s.First.Name) %>% summarise(freqM_H = sum(Count)) %>% arrange(desc(freqM_H)) %>% slice_head(n=10)

ef3_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "HISPANIC", Gender == "FEMALE") %>% group_by(Child.s.First.Name) %>% summarise(freqF_H = sum(Count)) %>% arrange(desc(freqF_H)) %>% slice_head(n=10)

# top 10 names in ethnic group of WNH between Males and Females
em4_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "WHITE NON HISPANIC", Gender == "MALE") %>% group_by(Child.s.First.Name) %>% summarise(freqM_WNH = sum(Count)) %>% arrange(desc(freqM_WNH)) %>% slice_head(n=10)

ef4_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "WHITE NON HISPANIC", Gender == "FEMALE") %>% group_by(Child.s.First.Name) %>% summarise(freqF_WNH = sum(Count)) %>% arrange(desc(freqF_WNH)) %>% slice_head(n=10)

```



# bar graph of top 10 names in ALL ethnic groups between boys and girls

```{r}
#| label: fig-genders
#| fig-width: 8
#| fig-height: 4 # Change the figure dimensions using fig-width/height
#| out-width: 80% # This changes the size of the figure as rendered in the text. 
#| fig-cap: "This figure shows top 10 popular male babies' first names in Asian and Pacific Islander"
#| echo: false


# display in ordered by count
em1_data$Child.s.First.Name <-factor(em1_data$Child.s.First.Name, levels = em1_data$Child.s.First.Name) 

ggplot(data = em1_data, aes(x = Child.s.First.Name, y = freqM_API)) + 
  geom_bar(stat = "identity", fill = 'lightblue') +  
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
  labs(title = "Top 10 Popular Male Babies' First Names in ASIAN AND PACIFIC ISLANDER",
       x = "Name",
       y = "Count") + 
      theme_minimal()
```





```{r}
#| label: fig-genders
#| fig-width: 8
#| fig-height: 4 # Change the figure dimensions using fig-width/height
#| out-width: 80% # This changes the size of the figure as rendered in the text. 
#| fig-cap: "This figure shows top 10 popular female babies' first names in Asian and Pacific Islander"
#| echo: false


# display in ordered by count
ef1_data$Child.s.First.Name <-factor(ef1_data$Child.s.First.Name, levels = ef1_data$Child.s.First.Name) 

ggplot(data = ef1_data, aes(x = Child.s.First.Name, y = freqF_API)) + 
  geom_bar(stat = "identity", fill = 'lightpink') +  
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
  labs(title = "Top 10 Popular Female Babies' First Names in ASIAN AND PACIFIC ISLANDER",
       x = "Name",
       y = "Count") + 
      theme_minimal()
```


```{r}
#| label: fig-genders
#| fig-width: 8
#| fig-height: 4 # Change the figure dimensions using fig-width/height
#| out-width: 80% # This changes the size of the figure as rendered in the text. 
#| fig-cap: "This figure shows top 10 popular male babies' first names in Black non Hispanic"
#| echo: false


# display in ordered by count
em2_data$Child.s.First.Name <-factor(em2_data$Child.s.First.Name, levels = em2_data$Child.s.First.Name) 

ggplot(data = em2_data, aes(x = Child.s.First.Name, y = freqM_BNH)) + 
  geom_bar(stat = "identity", fill = 'lightblue') +  
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
  labs(title = "Top 10 Popular Male Babies' First Names in Black non Hispanic",
       x = "Name",
       y = "Count") + 
      theme_minimal()
```




```{r}
#| label: fig-genders
#| fig-width: 8
#| fig-height: 4 # Change the figure dimensions using fig-width/height
#| out-width: 80% # This changes the size of the figure as rendered in the text. 
#| fig-cap: "This figure shows top 10 popular female babies' first names in Black non Hispanic"
#| echo: false


# display in ordered by count
ef2_data$Child.s.First.Name <-factor(ef2_data$Child.s.First.Name, levels = ef2_data$Child.s.First.Name) 

ggplot(data = ef2_data, aes(x = Child.s.First.Name, y = freqF_BNH)) + 
  geom_bar(stat = "identity", fill = 'lightpink') +  
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
  labs(title = "Top 10 Popular Female Babies' First Names in Black non Hispanic",
       x = "Name",
       y = "Count") + 
      theme_minimal()
```



```{r}
#| label: fig-genders
#| fig-width: 8
#| fig-height: 4 # Change the figure dimensions using fig-width/height
#| out-width: 80% # This changes the size of the figure as rendered in the text. 
#| fig-cap: "This figure shows top 10 popular male babies' first names in Hispanic"
#| echo: false


# display in ordered by count
em3_data$Child.s.First.Name <-factor(em3_data$Child.s.First.Name, levels = em3_data$Child.s.First.Name) 

ggplot(data = em3_data, aes(x = Child.s.First.Name, y = freqM_H)) + 
  geom_bar(stat = "identity", fill = 'lightblue') +  
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
  labs(title = "Top 10 Popular Male Babies' First Names in Hispanic",
       x = "Name",
       y = "Count") + 
      theme_minimal()
```




```{r}
#| label: fig-genders
#| fig-width: 8
#| fig-height: 4 # Change the figure dimensions using fig-width/height
#| out-width: 80% # This changes the size of the figure as rendered in the text. 
#| fig-cap: "This figure shows top 10 popular female babies' first names in Hispanic"
#| echo: false


# display in ordered by count
ef3_data$Child.s.First.Name <-factor(ef3_data$Child.s.First.Name, levels = ef3_data$Child.s.First.Name) 

ggplot(data = ef3_data, aes(x = Child.s.First.Name, y = freqF_H)) + 
  geom_bar(stat = "identity", fill = 'lightpink') +  
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
  labs(title = "Top 10 Popular Female Babies' First Names in Hispanic",
       x = "Name",
       y = "Count") + 
      theme_minimal()
```



```{r}
#| label: fig-genders
#| fig-width: 8
#| fig-height: 4 # Change the figure dimensions using fig-width/height
#| out-width: 80% # This changes the size of the figure as rendered in the text. 
#| fig-cap: "This figure shows top 10 popular male babies' first names in White Non Hispanic"
#| echo: false


# display in ordered by count
em4_data$Child.s.First.Name <-factor(em4_data$Child.s.First.Name, levels = em4_data$Child.s.First.Name) 

ggplot(data = em4_data, aes(x = Child.s.First.Name, y = freqM_WNH)) + 
  geom_bar(stat = "identity", fill = 'lightblue') +  
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
  labs(title = "Top 10 Popular Male Babies' First Names in White Non Hispanic",
       x = "Name",
       y = "Count") + 
      theme_minimal()
```




```{r}
#| label: fig-genders
#| fig-width: 8
#| fig-height: 4 # Change the figure dimensions using fig-width/height
#| out-width: 80% # This changes the size of the figure as rendered in the text. 
#| fig-cap: "This figure shows top 10 popular female babies' first names in White Non Hispanic"
#| echo: false


# display in ordered by count
ef4_data$Child.s.First.Name <-factor(ef4_data$Child.s.First.Name, levels = ef4_data$Child.s.First.Name) 

ggplot(data = ef4_data, aes(x = Child.s.First.Name, y = freqF_WNH)) + 
  geom_bar(stat = "identity", fill = 'lightpink') +  
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
  labs(title = "Top 10 Popular Female Babies' First Names in White Non Hispanic",
       x = "Name",
       y = "Count") + 
      theme_minimal()
```



# merge data sets for all males and females in different 4 ethnic groups
```{r}
#| echo: false

library(dplyr)

# develop merge of males between 2 ethnic groups
inner_M1 <- inner_join(em1_data, em3_data, by = "Child.s.First.Name")
inner_M2 <- inner_join(em2_data, em4_data, by = "Child.s.First.Name") 
inner_M2 # no common result; why? different culture

# expand dataset with top 20 names
em22_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "BLACK NON HISPANIC", Gender == "MALE") %>% group_by(Child.s.First.Name) %>% summarise(freqM_BNH = sum(Count)) %>% arrange(desc(freqM_BNH)) %>% slice_head(n=20)

em44_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "WHITE NON HISPANIC", Gender == "MALE") %>% group_by(Child.s.First.Name) %>% summarise(freqM_WNH = sum(Count)) %>% arrange(desc(freqM_WNH)) %>% slice_head(n=20)


inner_M22 <- inner_join(em22_data, em44_data, by = "Child.s.First.Name")
inner_M22 # luckily, we get common results but the culture plays an important role in names

####---------------------------------------------------------------------------------------------####

# develop merge of female between 2 ethnic groups
inner_F1 <- inner_join(ef1_data, ef3_data, by = "Child.s.First.Name")
inner_F2 <- inner_join(ef2_data, ef4_data, by = "Child.s.First.Name")
inner_F2 # only one common names

ef22_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "BLACK NON HISPANIC", Gender == "FEMALE") %>% group_by(Child.s.First.Name) %>% summarise(freqF_BNH = sum(Count)) %>% arrange(desc(freqF_BNH)) %>% slice_head(n=20)

ef44_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "WHITE NON HISPANIC", Gender == "FEMALE") %>% group_by(Child.s.First.Name) %>% summarise(freqF_WNH = sum(Count)) %>% arrange(desc(freqF_WNH)) %>% slice_head(n=20)

inner_F22 <- inner_join(ef22_data, ef44_data, by = "Child.s.First.Name")
inner_F22 # Again, cultures difference 

####-----------------------------------------------------------------------####
```


```{r}
#| echo: false

## Develop Unisex Name: merge males and females within the same ethnic groups 

em1_100_data <- modified_data %>% filter(Ethnicity == "ASIAN AND PACIFIC ISLANDER" & Gender == "MALE") %>% group_by(Child.s.First.Name) %>% summarise(freqM_API = sum(Count), .groups = "drop") %>% arrange(desc(freqM_API)) %>% head(n=1000)

ef1_100_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "ASIAN AND PACIFIC ISLANDER", Gender == "FEMALE") %>% group_by(Child.s.First.Name) %>% summarise(freqF_API = sum(Count)) %>% arrange(desc(freqF_API)) %>% slice_head(n=1000)

inner_com1 <- inner_join(em100_data, ef100_data, by = "Child.s.First.Name")
# found 1 unisex name


em2_100_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "BLACK NON HISPANIC", Gender == "MALE") %>% group_by(Child.s.First.Name) %>% summarise(freqM_BNH = sum(Count)) %>% arrange(desc(freqM_BNH)) %>% slice_head(n=1000)

ef2_100_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "BLACK NON HISPANIC", Gender == "FEMALE") %>% group_by(Child.s.First.Name) %>% summarise(freqF_BNH = sum(Count)) %>% arrange(desc(freqF_BNH)) %>% slice_head(n=1000)

inner_com2 <- inner_join(em2_100_data, ef2_100_data, by = "Child.s.First.Name")
# no result

### selected 1000 to see whether there is unisex name; check M_data2 to each # of each gender or ethnic group
em3_100_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "HISPANIC", Gender == "MALE") %>% group_by(Child.s.First.Name) %>% summarise(freqM_H = sum(Count)) %>% arrange(desc(freqM_H)) %>% slice_head(n=1000)

ef3_100_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "HISPANIC", Gender == "FEMALE") %>% group_by(Child.s.First.Name) %>% summarise(freqF_H = sum(Count)) %>% arrange(desc(freqF_H)) %>% slice_head(n=1000)

inner_com3 <- inner_join(em3_100_data, ef3_100_data, by = "Child.s.First.Name")


em4_100_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "WHITE NON HISPANIC", Gender == "MALE") %>% group_by(Child.s.First.Name) %>% summarise(freqM_WNH = sum(Count)) %>% arrange(desc(freqM_WNH)) %>% slice_head(n=1000)

ef4_100_data <- modified_data %>% select('Ethnicity', 'Gender' , 'Child.s.First.Name', 'Count') %>% filter(Ethnicity == "WHITE NON HISPANIC", Gender == "FEMALE") %>% group_by(Child.s.First.Name) %>% summarise(freqF_WNH = sum(Count)) %>% arrange(desc(freqF_WNH)) %>% slice_head(n=1000)

inner_com4 <- inner_join(em4_100_data, ef4_100_data, by = "Child.s.First.Name")

```


#Plot side by side bar graph

```{r}
#| label: fig-ethnic
#| fig-width: 8
#| fig-height: 4 
#| out-width: 80%  
#| fig-cap: "This figure shows MALES babies' first names in Asian Pacific Islander and Hispanic"
#| echo: false


melt_M1 <- melt(inner_M1, id.vars = 'Child.s.First.Name')
melt_M1$variable <- as.character(melt_M1$variable )
melt_M1$variable <- gsub('freqM_API', 'Asian Pacific Islander - Male', melt_M1$variable)
melt_M1$variable <- gsub('freqM_H', 'Hispanic - Male', melt_M1$variable)

ggplot(data = melt_M1, aes(x = Child.s.First.Name, y = value, fill = variable)) + 
  geom_bar(stat = "identity", position = position_dodge()) +  
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +  
  labs(title = "Common Males Frist Name Between Asian Pacific Islander and Hispanic",
        subtitle = "within top 10", 
       x = "Name",
       y = "Frequency",
       fill = "Ethnic Group")+
  theme_minimal()

```


```{r}
#| label: fig-ethnic
#| fig-width: 8
#| fig-height: 4 
#| out-width: 80%  
#| fig-cap: "This figure shows male babies' first names in Black non-Hispanic and White non-Hispanic"
#| echo: false


melt_M22 <- melt(inner_M22, id.vars = 'Child.s.First.Name')
melt_M22$variable <- as.character(melt_M22$variable )
melt_M22$variable <- gsub('freqM_BNH', 'Black non-Hispanic - Male', melt_M22$variable)
melt_M22$variable <- gsub('freqM_WNH', 'White non-Hispanic - Male', melt_M22$variable)

ggplot(data = melt_M22, aes(x = Child.s.First.Name, y = value, fill = variable)) + 
  geom_bar(stat = "identity", position = position_dodge()) +  
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +  
  labs(title = "Common Males Frist Name Between Black non-Hispanic and White non-Hispanic",
        subtitle = "within top 20", 
       x = "Name",
       y = "Frequency",
       fill = "Ethnic Group")+
  theme_minimal()

```



```{r}
#| label: fig-ethnic
#| fig-width: 8
#| fig-height: 4 
#| out-width: 80%  
#| fig-cap: "This figure shows FEMALES babies' first names in Asian Pacific Islander and Hispanic"
#| echo: false


inner_F1 <- melt(inner_F1, id.vars = 'Child.s.First.Name')
inner_F1$variable <- as.character(inner_F1$variable )
inner_F1$variable <- gsub('freqF_API', 'Asian Pacific Islander - Female', inner_F1$variable)
inner_F1$variable <- gsub('freqF_H', 'Hispanic - Female', inner_F1$variable)

ggplot(data = inner_F1, aes(x = Child.s.First.Name, y = value, fill = variable)) + 
  geom_bar(stat = "identity", position = position_dodge()) +  
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +  
  labs(title = "Common Female Frist Name Between Asian Pacific Islander and Hispanic",
        subtitle = "within top 10", 
       x = "Name",
       y = "Frequency",
       fill = "Ethnic Group") +
  theme_minimal()
```



```{r}
#| label: fig-ethnic
#| fig-width: 8
#| fig-height: 4 
#| out-width: 80%  
#| fig-cap: "This figure shows female babies' first names in Black non-Hispanic and White non-Hispanic"
#| echo: false


melt_F2 <- melt(inner_F2, id.vars = 'Child.s.First.Name')
melt_F2$variable <- as.character(melt_F2$variable )
melt_F2$variable <- gsub('freqF_BNH', 'Black non-Hispanic - Female', melt_F2$variable)
melt_F2$variable <- gsub('freqF_WNH', 'White non-Hispanic - Female', melt_F2$variable)

ggplot(data = melt_F2, aes(x = Child.s.First.Name, y = value, fill = variable)) + 
  geom_bar(stat = "identity", position = position_dodge()) +  
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +  
  labs(title = "Common Males Frist Name Between Black non-Hispanic and White non-Hispanic",
        subtitle = "within top 10", 
       x = "Name",
       y = "Frequency",
       fill = "Ethnic Group")+
  theme_minimal()

```




```{r}
#| label: fig-ethnic
#| fig-width: 8
#| fig-height: 4 
#| out-width: 80%  
#| fig-cap: "This figure shows female babies' first names in Black non-Hispanic and White non-Hispanic"
#| echo: false


melt_F22 <- melt(inner_F22, id.vars = 'Child.s.First.Name')
melt_F22$variable <- as.character(melt_F22$variable )
melt_F22$variable <- gsub('freqF_BNH', 'Black non-Hispanic - Female', melt_F22$variable)
melt_F22$variable <- gsub('freqF_WNH', 'White non-Hispanic - Female', melt_F22$variable)

ggplot(data = melt_F22, aes(x = Child.s.First.Name, y = value, fill = variable)) + 
  geom_bar(stat = "identity", position = position_dodge()) +  
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +  
  labs(title = "Common Males Frist Name Between Black non-Hispanic and White non-Hispanic",
        subtitle = "within top 20", 
       x = "Name",
       y = "Frequency",
       fill = "Ethnic Group")+
  theme_minimal()

```



### Time Plot of Average Length of First Names by Gender

```{r}
#| echo: false

library(stringr)
# calculate the length of letter of each name
length_data <- modified_data %>% mutate(N.Length = str_count(Child.s.First.Name, "[A-Za-z]")) %>% mutate(T.length = Count * N.Length) 
# calculate the average number of letters in each year for males and females
avglength_data <- length_data  %>% group_by(Year.of.Birth, Gender) %>% 
  summarise(Avg.Letters = mean(N.Length, na.rm = TRUE), .groups = "drop") %>% 
  arrange(Year.of.Birth, Gender)
# calculate the average number of letters in each year for each ethnic groups
avglength_data_ethnic <- length_data  %>% group_by(Year.of.Birth, Ethnicity) %>% 
  summarise(Avg.Letters = mean(N.Length, na.rm = TRUE), .groups = "drop") %>% 
  arrange(Year.of.Birth, Ethnicity)

```



```{r}
#| label: fig-AverageLength
#| fig-width: 8
#| fig-height: 4 
#| out-width: 80%  
#| fig-cap: "This figure shows average length of babies' first name for female and male from 2011 to 2019"
#| echo: false


ggplot(data = avglength_data, aes(x = Year.of.Birth, y = Avg.Letters, color = Gender, group = Gender)) + 
  geom_line() +
  geom_point() +
  scale_x_continuous(breaks = seq(2011, 2019, by=1), limits = c(2011, 2019)) +
  labs(title = "Average Number of Letters in Babies' Name by Gender", 
       subtitle = "from 2011 to 2019", 
       x = "Year", 
       y = "Average Number of Letters") + 
    theme_minimal()
```


### Time Plot of Average Length of First Names by Ethnic Groups
```{r}
#| label: fig-AverageLength
#| fig-width: 8
#| fig-height: 4 
#| out-width: 80%  
#| fig-cap: "This figure shows average length of babies' first name for different ethnic groups from 2011 to 2019"
#| echo: false


ggplot(data = avglength_data_ethnic, aes(x = Year.of.Birth, y = Avg.Letters, color = Ethnicity, group = Ethnicity)) + 
  geom_line() +
  geom_point() +
  scale_x_continuous(breaks = seq(2011, 2019, by=1), limits = c(2011, 2019)) +
  labs(title = "Average Number of Letters in Babies' Name by Ethnicity", 
       subtitle = "from 2011 to 2019", 
       x = "Year", 
       y = "Average Number of Letters") + 
    theme_minimal()
```



### word clouds (interactive graph; ref: 12; plot the UNISEX name)


### Need to modify.... Cannot remember where I found this reference 
```{r}
#| echo: false

babynames %>%
  filter(name %in% c("William", "Will", "Bill") & sex== "M") %>%
  ggplot(aes(year, n, colour=name)) + geom_line() + 
  theme_economist() +
  xlab("Year") + 
  ylab("Number of People") +
  ggtitle("Changes in Popularity of the Name William")


```









#### THIS IS ORIGINAL CODING FROM qmd. FILE

The `echo: false` option disables the printing of code (only output is displayed).
If you generate a figure, it should have a caption. Here's a demonstration of how to do that:


```{r iris-plot}
#| label: fig-iris
#| fig-width: 8
#| fig-height: 4 # Change the figure dimensions using fig-width/height
#| out-width: 80% # This changes the size of the figure as rendered in the text. 
#| fig-cap: "This figure shows the relationship between sepal width and petal width in irises. I've used geom_jitter to combat overplotting, as the data are measured in relatively consistent increments. The figure is drawn with `ggplot2` [@ggplot2-package]."
#| echo: false


data(iris)
library(ggplot2)
ggplot(iris, aes(x = Sepal.Width, y = Petal.Width, color = Species)) + 
  geom_jitter() + 
  xlab("Sepal Width (cm)") + ylab("Petal Width (cm)") + 
  ggtitle("Sepal and Petal Dimensions")
```

Then, you can reference @fig-iris in the text and the appropriate cross-reference will be generated.

You can find additional information about formatting figures generated from code in the [quarto documentation](https://quarto.org/docs/authoring/figures.html#computations).

## Additional Exploration topic

Add another topic here... as many as you desire, really. Make sure to include a transition between the two sections that connects the two with some sort of logical train of thought.

## Conclusion

Here, you want to summarize the main points of what you've learned from this investigation, in paragraph form.

## Tips

(delete this section from your report!)

Almost anything you might want to know about how to format output in quarto can be found [here](https://quarto.org/docs/authoring/markdown-basics.html). Feel free to email/come to office hours to figure out how to do XYZ - part of the goal of making you write this report is that I want you to know how to write e.g. a journal paper in Quarto as well, so now's the time to experiment.

If you want to know what the wordcount of your report is, you can run the following command in your terminal:

```         
pandoc --lua-filter wordcount.lua report.qmd
```

Notice that I have not pushed `_output/report.html` or the `_output/report_files/` folder to github - this is intentional. I have actually set `_output` to not show up in git, to encourage you all to NOT push the rendered files to github and to instead work from the markdown files directly.

You may find it cleaner to create a figure subdirectory and store any figures that aren't created by R/Python in that folder. I encourage you to organize this repository in a sensible way.
